<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Perform DESeq differential analysis — run_deseq2 • microbiomeMarker</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Perform DESeq differential analysis — run_deseq2" />
<meta property="og:description" content="Differential expression analysis based on the Negative Binomial distribution
using DESeq2." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">microbiomeMarker</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/microbiomeMarker-vignette.html">Tools for microbiome marker identification</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/yiluheihei/microbiomeMarker/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Perform DESeq differential analysis</h1>
    <small class="dont-index">Source: <a href='https://github.com/yiluheihei/microbiomeMarker/blob/master/R/DA-deseq2.R'><code>R/DA-deseq2.R</code></a></small>
    <div class="hidden name"><code>run_deseq2.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Differential expression analysis based on the Negative Binomial distribution
using <strong>DESeq2</strong>.</p>
    </div>

    <pre class="usage"><span class='fu'>run_deseq2</span><span class='op'>(</span>
  <span class='va'>ps</span>,
  <span class='va'>group</span>,
  contrast <span class='op'>=</span> <span class='cn'>NULL</span>,
  taxa_rank <span class='op'>=</span> <span class='st'>"all"</span>,
  norm <span class='op'>=</span> <span class='st'>"RLE"</span>,
  norm_para <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span>,
  transform <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/S4Vectors/man/Vector-class.html'>c</a></span><span class='op'>(</span><span class='st'>"identity"</span>, <span class='st'>"log10"</span>, <span class='st'>"log10p"</span><span class='op'>)</span>,
  fitType <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/S4Vectors/man/Vector-class.html'>c</a></span><span class='op'>(</span><span class='st'>"parametric"</span>, <span class='st'>"local"</span>, <span class='st'>"mean"</span>, <span class='st'>"glmGamPoi"</span><span class='op'>)</span>,
  sfType <span class='op'>=</span> <span class='st'>"poscounts"</span>,
  betaPrior <span class='op'>=</span> <span class='cn'>FALSE</span>,
  <span class='va'>modelMatrixType</span>,
  useT <span class='op'>=</span> <span class='cn'>FALSE</span>,
  minmu <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>fitType</span> <span class='op'>==</span> <span class='st'>"glmGamPoi"</span>, <span class='fl'>1e-06</span>, <span class='fl'>0.5</span><span class='op'>)</span>,
  p_adjust <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/S4Vectors/man/Vector-class.html'>c</a></span><span class='op'>(</span><span class='st'>"none"</span>, <span class='st'>"fdr"</span>, <span class='st'>"bonferroni"</span>, <span class='st'>"holm"</span>, <span class='st'>"hochberg"</span>, <span class='st'>"hommel"</span>, <span class='st'>"BH"</span>, <span class='st'>"BY"</span><span class='op'>)</span>,
  pvalue_cutoff <span class='op'>=</span> <span class='fl'>0.05</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>ps</th>
      <td><p>ps a <code><a href='https://rdrr.io/pkg/phyloseq/man/phyloseq-class.html'>phyloseq::phyloseq</a></code> object.</p></td>
    </tr>
    <tr>
      <th>group</th>
      <td><p>character, the variable to set the group, must be one of
the var of the sample metadata.</p></td>
    </tr>
    <tr>
      <th>contrast</th>
      <td><p>this parameter only used for two groups comparison while
there are multiple groups. For more please see the following details.</p></td>
    </tr>
    <tr>
      <th>taxa_rank</th>
      <td><p>character to specify taxonomic rank to perform
differential analysis on. Should be one of
<code>phyloseq::rank_names(phyloseq)</code>, or "all" means to summarize the taxa by
the top taxa ranks (<code>summarize_taxa(ps, level = rank_names(ps)[1])</code>), or
"none" means perform differential analysis on the original taxa
(<code>taxa_names(phyloseq)</code>, e.g., OTU or ASV).</p></td>
    </tr>
    <tr>
      <th>norm</th>
      <td><p>the methods used to normalize the microbial abundance data. See
<code><a href='normalize,phyloseq-method.html'>normalize()</a></code> for more details.
Options include:</p><ul>
<li><p>"none": do not normalize.</p></li>
<li><p>"rarefy": random subsampling counts to the smallest library size in the
data set.</p></li>
<li><p>"TMM": trimmed mean of m-values. First, a sample is chosen as reference.
The scaling factor is then derived using a weighted trimmed mean over the
differences of the log-transformed gene-count fold-change between the
sample and the reference.</p></li>
<li><p>"RLE", relative log expression, RLE uses a pseudo-reference calculated
using the geometric mean of the gene-specific abundances over all
samples. The scaling factors are then calculated as the median of the
gene counts ratios between the samples and the reference.</p></li>
<li><p>"CSS": cumulative sum scaling, calculates scaling factors as the
cumulative sum of gene abundances up to a data-derived threshold.</p></li>
</ul></td>
    </tr>
    <tr>
      <th>norm_para</th>
      <td><p>arguments passed to specific normalization methods. Most
users will not need to pass any additional arguments here.</p></td>
    </tr>
    <tr>
      <th>transform</th>
      <td><p>character, the methods used to transform the microbial
abundance. See <code><a href='transform_abundances.html'>transform_abundances()</a></code> for more details. The
options include:</p><ul>
<li><p>"identity", return the original data without any transformation
(default).</p></li>
<li><p>"log10", the transformation is <code>log10(object)</code>, and if the data contains
zeros the transformation is <code>log10(1 + object)</code>.</p></li>
<li><p>"log10p", the transformation is <code>log10(1 + object)</code>.</p></li>
</ul></td>
    </tr>
    <tr>
      <th>fitType, sfType, betaPrior, modelMatrixType, useT, minmu</th>
      <td><p>these seven
parameters are inherited form <code><a href='https://rdrr.io/pkg/DESeq2/man/DESeq.html'>DESeq2::DESeq()</a></code>.</p><ul>
<li><p><code>fitType</code>, either "parametric", "local", "mean", or "glmGamPoi" for the
type of fitting of dispersions to the mean intensity.</p></li>
<li><p><code>sfType</code>, either "ratio", "poscounts", or "iterate" for the type of size
factor estimation. We recommend to use "poscounts".</p></li>
<li><p><code>betaPrior</code>, whether or not to put a zero-mean normal prior on the
non-intercept coefficients.</p></li>
<li><p><code>modelMatrixType</code>, either "standard" or "expanded", which describe how
the model matrix,</p></li>
<li><p><code>useT</code>, logical, where Wald statistics are assumed to follow a standard
Normal.</p></li>
<li><p><code>minmu</code>, lower bound on the estimated count for fitting gene-wise
dispersion.</p></li>
</ul>

<p>For more details, see <code><a href='https://rdrr.io/pkg/DESeq2/man/DESeq.html'>DESeq2::DESeq()</a></code>.  Most users will not need to
set this arguments (just use the defaults).</p></td>
    </tr>
    <tr>
      <th>p_adjust</th>
      <td><p>method for multiple test correction, default <code>none</code>, for
more details see <a href='https://rdrr.io/r/stats/p.adjust.html'>stats::p.adjust</a>.</p></td>
    </tr>
    <tr>
      <th>pvalue_cutoff</th>
      <td><p>pvalue_cutoff numeric, p value cutoff, default 0.05.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>extra parameters passed to <code><a href='https://rdrr.io/pkg/DESeq2/man/DESeq.html'>DESeq2::DESeq()</a></code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>a <code><a href='microbiomeMarker-class.html'>microbiomeMarker</a></code> object.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><strong>Note</strong>: DESeq2 requires the input is raw counts (un-normalized counts), as
only the counts values allow assessing the measurement precision correctly.
For more details see the vignette of DESeq2 (<code>vignette("DESeq2")</code>).</p>
<p>Thus, this function only supports "none", "rarefy", "RLE", "CSS", and
"TMM" normalization methods. We strongly recommend using the "RLE" method
(default normalization method in the DESeq2 package). The other
normalization methods are used for expert users and comparisons among
different normalization methods.</p>
<p>For two groups comparison, this function utilizes the Wald test (defined by
<code><a href='https://rdrr.io/pkg/DESeq2/man/nbinomWaldTest.html'>DESeq2::nbinomWaldTest()</a></code>) for hypothesis testing. A Wald test statistic
is computed along with a probability (p-value) that a test statistic at least
as extreme as the observed value were selected at random. <code>contrasts</code> are
used to specify which two groups to compare. The order of the names
determines the direction of fold change that is reported.</p>
<p>Likelihood ratio test (LRT) is used to identify the genes that significantly
changed across all the different levels for multiple groups comparisons. The
LRT identified the significant features by comparing the full model to the
reduced model. It is testing whether a feature removed in the reduced
model explains a significant variation in the data.</p>
<p><code>contrast</code> must be a two length character or <code>NULL</code> (default). It is only
required to set manually for two groups comparison when there are multiple
groups. The order determines the direction of comparison, the first element
is used to specify the reference group (control). This means that, the first
element is the denominator for the fold change, and the second element is
used as baseline (numerator for fold change). Otherwise, users do required
to concern this parameter (set as default <code>NULL</code>), and if there are
two groups, the first level of groups will set as the reference group; if
there are multiple groups, it will perform an ANOVA-like testing to find
markers which difference in any of the groups.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Love, Michael I., Wolfgang Huber, and Simon Anders. "Moderated estimation
of fold change and dispersion for RNA-seq data with DESeq2." Genome
biology 15.12 (2014): 1-21.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='https://rdrr.io/pkg/DESeq2/man/results.html'>DESeq2::results()</a></code>,<code><a href='https://rdrr.io/pkg/DESeq2/man/DESeq.html'>DESeq2::DESeq()</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='r-in'><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>enterotypes_arumugam</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>ps</span> <span class='op'>&lt;-</span> <span class='fu'>phyloseq</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/phyloseq/man/subset_samples-methods.html'>subset_samples</a></span><span class='op'>(</span></span>
<span class='r-in'>    <span class='va'>enterotypes_arumugam</span>,</span>
<span class='r-in'>    <span class='va'>Enterotype</span> <span class='op'><a href='https://rdrr.io/pkg/BiocGenerics/man/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/pkg/S4Vectors/man/Vector-class.html'>c</a></span><span class='op'>(</span><span class='st'>"Enterotype 3"</span>, <span class='st'>"Enterotype 2"</span><span class='op'>)</span></span>
<span class='r-in'><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span class='r-in'>    <span class='fu'>phyloseq</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/phyloseq/man/subset_taxa-methods.html'>subset_taxa</a></span><span class='op'>(</span><span class='va'>Phylum</span> <span class='op'><a href='https://rdrr.io/pkg/BiocGenerics/man/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/pkg/S4Vectors/man/Vector-class.html'>c</a></span><span class='op'>(</span><span class='st'>"Firmicutes"</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-in'><span class='fu'>run_deseq2</span><span class='op'>(</span><span class='va'>ps</span>, group <span class='op'>=</span> <span class='st'>"Enterotype"</span><span class='op'>)</span></span>
<span class='r-wrn co'><span class='r-pr'>#&gt;</span> <span class='warning'>Warning: </span>Not all reads are integers, the reads are ceiled to integers.</span>
<span class='r-wrn co'><span class='r-pr'>#&gt;</span>    Raw reads is recommended from the ALDEx2 paper.</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> converting counts to integer mode</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>   Note: levels of factors in the design contain characters other than</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>   letters, numbers, '_' and '.'. It is recommended (but not required) to use</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>   only letters, numbers, and delimiters '_' or '.', as these are safe characters</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>   for column names in R. [This is a message, not a warning or an error]</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>   Note: levels of factors in the design contain characters other than</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>   letters, numbers, '_' and '.'. It is recommended (but not required) to use</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>   only letters, numbers, and delimiters '_' or '.', as these are safe characters</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>   for column names in R. [This is a message, not a warning or an error]</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>   Note: levels of factors in the design contain characters other than</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>   letters, numbers, '_' and '.'. It is recommended (but not required) to use</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>   only letters, numbers, and delimiters '_' or '.', as these are safe characters</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>   for column names in R. [This is a message, not a warning or an error]</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>   Note: levels of factors in the design contain characters other than</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>   letters, numbers, '_' and '.'. It is recommended (but not required) to use</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>   only letters, numbers, and delimiters '_' or '.', as these are safe characters</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>   for column names in R. [This is a message, not a warning or an error]</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>   Note: levels of factors in the design contain characters other than</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>   letters, numbers, '_' and '.'. It is recommended (but not required) to use</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>   only letters, numbers, and delimiters '_' or '.', as these are safe characters</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>   for column names in R. [This is a message, not a warning or an error]</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>   Note: levels of factors in the design contain characters other than</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>   letters, numbers, '_' and '.'. It is recommended (but not required) to use</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>   only letters, numbers, and delimiters '_' or '.', as these are safe characters</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>   for column names in R. [This is a message, not a warning or an error]</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> microbiomeMarker-class inherited from phyloseq-class</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> normalization method:              [ RLE ]</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> microbiome marker identity method: [ DESeq2: Wald ]</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> marker_table() Marker Table:       [ 6 microbiome markers with 5 variables ]</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> otu_table()    OTU Table:          [ 78 taxa and  24 samples ]</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> sample_data()  Sample Data:        [ 24 samples by  10 sample variables ]</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> tax_table()    Taxonomy Table:     [ 78 taxa by 1 taxonomic ranks ]</span>
</pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Yang Cao.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


